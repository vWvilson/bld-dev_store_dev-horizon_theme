<!-- /templates/product.quickview.liquid -->
<link rel="stylesheet" href="{{ 'product-quickview.css' | asset_url }}" media="print" onload="this.media='all'">
<noscript>{{ 'product-quickview.css' | asset_url | stylesheet_tag }}</noscript>
{{ "jquery.elevatezoom.min.js" | asset_url | script_tag }}

{% include 'linked-options-quickview' %}
<script>
  var productsObj = {};
  var dataZoom = {};
  var swatch_color_type = {{ settings.product_swatch_type }};
  var product_swatch_size = '{{settings.product_swatch_size}}';
  var product_swatch_setting = '{{settings.product_swatch_setting}}';
  dataZoom.lightbox = false;
  dataZoom.position = '{{ settings.media_zoom_position }}';
</script>
{%- layout none -%}
{% assign variant_tmp = product.selected_or_first_available_variant | default: product.variants.first %}
{% assign featured_image = current_variant.featured_image | default: product.featured_image %}
{% assign media_col = settings.product_image_size %}
{% assign main_col = 12 | minus: settings.product_image_size %}
<div class="product-quick-view product-view">
  <div class="product-essential row">
    <div class="product-img-box col-md-6 mb-0">
      <div class="product-img-list">
        {% include 'media-quickview' %}
      </div>
    </div>
    <div class="product-shop col-md-6 mb-0">
      <div class="product-shop-wrapper">
        <div class="product-name top-product-detail">
          <h1>
            <a href="{{ product.url | within: collection }}">
              {{ product.title }}
            </a>
          </h1>
          <div style="display: -webkit-box; overflow:hidden; -webkit-box-orient: vertical; -webkit-line-clamp: 3;"> {{ product.description |within: collection }} </div>
        </div>
        <div class="review-product-details">
          <span class="prorw_preview_badge_setup" id="prorw_preview_badge_id_{{ product.id }}" data-product-id="{{ product.id }}" data-average-ratings="{% if product.metafields.proviews.averageRatings != blank %}{{product.metafields.proviews.averageRatings}}{% else %}0{% endif %}" data-count="{% if product.metafields.proviews.totalReviewCount != blank %}{{product.metafields.proviews.totalReviewCount}}{% else %}0{% endif %}"></span>
          <!--<span class="shopify-product-reviews-badge" data-id="{{ product.id }}"></span>-->
        </div>
        {% if settings.product_short_desc != '0' %}
        <div class="short-description-detail">
          <div class="short-description">
            {%- assign description = product.description -%}
            {%- if product.description contains '[shortdesc]' and settings.product_short_desc == '1' -%}
            {%- assign last = description | split:'[shortdesc]' | last -%}
            {%- assign description = last | split:'[/shortdesc]' | first -%}
            {%- else -%}
            {%- if product.description contains '[countdown]' -%}
            {%- assign description = description | split:'[/countdown]' | last -%}
            {%- endif -%}
            {%- if product.description contains '[shortdesc]' -%}
            {%- assign description = description | split:'[/shortdesc]' | last -%}
            {%- endif -%}
            {%- if product.description contains '[additional]' -%}
            {%- assign description = description | split:'[/additional]' | last -%}
            {%- endif -%}
            {%- if settings.product_short_desc == '1' -%}
            {%- assign description = description | strip_html | truncatewords: 30 -%}
            {%- endif -%}
            {%- endif -%}
            {{ description }}
          </div>
        </div>
        {% endif %}
        <div class="middle-product-detail">
          <div class="product-type-data">
            <div class="price-box">
              <div id="price" class="detail-price" itemprop="price">
                {% if variant_tmp.compare_at_price > variant_tmp.price %}
                <s class="old-price"> {{ variant_tmp.compare_at_price | money }}</s>
                <!--span class="price_percentage">-{{ variant_tmp.compare_at_price | minus: variant_tmp.price | times: 100.0 | divided_by: variant_tmp.compare_at_price | money_without_currency | times: 100 | remove: '.0'}}%</span-->
                {% endif %}
                {% if variant_tmp.price  == 0 %}
                  <p></p>
                {% else %}
                <div class="price">{{ variant_tmp.price | money }}</div>
                {% endif %}
              </div>
              <meta itemprop="priceCurrency" content="{{ shop.currency }}" />
              {% if product.selected_or_first_available_variant.inventory_quantity <= 0%}
                <p class="live-inventory-count icon-check" style="color: #f20; font-size: 0.9rem; margin-bottom: 0px; font-weight: 100;">Out of Stock - Contact Customer Service</p>
              {% elsif product.selected_or_first_available_variant.inventory_quantity > 0 and product.selected_or_first_available_variant.inventory_quantity <= 10 %}
                <p class="live-inventory-count icon-check" style="color: #f20; font-size: 0.9rem; margin-bottom: 0px; font-weight: 100;">Hurry Up! Only <b>{{product.selected_or_first_available_variant.inventory_quantity}}</b> Left!</p>
              {% else %}
                <p class="live-inventory-count  icon-check" style="color: #f20; font-size: 0.9rem; margin-bottom: 0px; font-weight: 100;">We have <b>{{product.selected_or_first_available_variant.inventory_quantity}}</b> Available in Stock!</p>
              {% endif %} 
              {%- if settings.product_vendor -%}
                  {%- assign lead_time = product.metafields.product.lead_time | metafield_text -%}
              {% if lead_time != blank and product.selected_or_first_available_variant.inventory_quantity > 0 %}
					<p style="color: #0078a9; font-size: 0.9rem; font-weight: 500;">Need More? Current Lead Time: {{ product.metafields.product.lead_time }}</p>
              {% else %}
					<p style="color: #0078a9; font-size: 0.9rem; font-weight: 500;">Lead Time: {{ product.metafields.product.lead_time }}</p>
              {%- endif -%} 
            {%- endif -%}
              {% if product.available %}
              <link itemprop="availability" href="http://schema.org/InStock" />
              {% else %}
              <link itemprop="availability" href="http://schema.org/OutOfStock" />
              {% endif %}
            </div>
          </div>
          {% if settings.product_availability %}
          <div class="product-inventory">
            <span>{{ 'products.product.availability' | t }} </span>
            <span class="in-stock">
              {% if product.selected_or_first_available_variant.inventory_management %}
              {% assign first_inventory = product.selected_or_first_available_variant.inventory_quantity %}
              {% if first_inventory > 0 %}
              {{first_inventory}} {{ 'products.product.in_stock' | t }}
              {% else %}
              {{ 'products.product.out_of_stock' | t }}
              {% endif %}
              {% else %}
              {{ 'products.product.many_in_stock' | t }}
              {% endif %}
            </span>
          </div>
          {% endif %}
          {% if settings.product_sku %}
          {% assign current_variant = product.selected_or_first_available_variant %}
          <div class="product-sku"><span>{{ 'products.product.sku' | t }} </span><span class="sku">{{ product.selected_or_first_available_variant.sku }}</span></div>
          {% endif %}
          {%- if settings.product_category -%} 
            <div class="product-category">
              <span>{{ 'products.product.category' | t }}</span>
              <span class="category-list">
                {%- for collection in product.collections limit:4 -%}
                {{ collection.title | link_to: collection.url }}{%- if forloop.last == false -%},&nbsp;{%- endif -%}
                {%- endfor -%} 
              </span>  
            </div>
            {%- endif -%}
            {%- if settings.product_type -%}
            <div class="product-type">
              <span>{{ 'products.product.product_type' | t }} </span>
              <span>{{ product.type }}</span>
            </div>
            {%- endif -%}
            {%- if settings.product_vendor -%}
            <div class="product-vendor">
              <span>{{ 'products.product.product_vendor' | t }} </span>
              <span>{{ product.vendor }}</span>
            </div>
            {%- endif -%} 
          {% if product.description contains '[countdown]' %}
          {% assign count_down_first = product.description | split:'[/countdown]' | first %}
          {% assign count_down_final = count_down_first | split:'[countdown]' | last %}
          <div class="bottom-product-dailydeal bottom-home-dailydeal">
            <span class="title">{{'products.product.count_down' | t }} </span><div class="product-date" data-date="{{ count_down_final }}"></div>
          </div>
          {% endif %}
        </div>
        <div class="product-type-main">
          <form class="product-form" action="/cart/add" method="post" enctype="multipart/form-data" data-product-id="{{product.id}}" data-id="{{ product.handle }}">
            <div class="product-options" {% if product.options.size == 1 and product.options.first == 'Title' %}style="display: none;"{% endif %}>
              <select id="quick-product-selectors" name="id" style="display: none;">
                {% for variant in product.variants %}
                {% if variant.available %}
                <option {% if variant == product.selected_or_first_available_variant %} selected="selected" {% endif %} value="{{ variant.id }}">{{ variant.title }} - {{ variant.price | money_with_currency }}</option>
                {% else %}
                <option disabled="disabled">
                  {{ variant.title }} - {{'products.product.sold_out' | t}}
                </option>
                {% endif %}
                {% endfor %}
              </select>
            </div>
            <div class="product-options-bottom">
              <div class="add-to-cart-box">
                <div class="input-box">
                  <input type="text" id="qty" name="quantity" value="1" min="1" class="quantity-selector">
                  <div class="plus-minus">
                    <div class="increase items" onclick="var result = document.getElementById('qty'); var qty = result.value; if( !isNaN( qty )) result.value++;return false;">
                      <i class="icon-up-dir"></i>
                    </div>
                    <div class="reduced items" onclick="var result = document.getElementById('qty'); var qty = result.value; if( !isNaN( qty ) &amp;&amp; qty > 1 ) result.value--;return false;">
                      <i class="icon-down-dir"></i>
                    </div>
                  </div>
                </div>
                <div class="actions">
                  <div class="action-list addtocart">
                    <div class="button-wrapper">
                      {%- if product.selected_or_first_available_variant.inventory_quantity > 0 -%}
                      <div class="button-wrapper-content">
                        <button type="submit" name="add" class="btn-cart add-to-cart bordered uppercase"> 
                          <i class="icon-cart"></i>
                          <span>{{ 'products.product.add_to_cart' | t }}</span>
                        </button>
                      </div>
                      {% else %}
                      <div class="button-wrapper-content">
                        <!--<button href="javascript:;" class="btn-cart add-to-cart" disabled="disabled">-->
                        <a href="/pages/contact" class="btn-cart bordered uppercase">
                          <i class="icon-support"></i>
                          <span>{{ 'products.product.sold_out' | t }}</span></a>
                      </div>
                      {%- endif -%}
                    </div>
                  </div>
                  {% if settings.disable_addtolink == blank %}
                  <div class="action-list wishlist">
                    {% include 'wishlist-item'%}
                  </div>
                  {% endif %}
                </div>
              </div>
            </div>
          </form>
        </div>
        {%- if settings.disable_socical_icon == blank -%}
        {% include 'sharelink' %}
        {%- endif -%}
      </div>
    </div>
  </div>
  <script>
    productsObj.id{{product.id}} = {{product | json}};
    selectCallback = function(variant, selector) {
      if (variant) {
        if (variant.compare_at_price > variant.price) {
          $("#price").html('<del class="price_compare">' + Shopify.formatMoney(variant.compare_at_price, money_format) + "</del>" + '<div class="price">' + Shopify.formatMoney(variant.price, money_format) + "</div>")
        } else {
          $("#price").html('<div class="price">' + Shopify.formatMoney(variant.price, money_format) + "</div>");
        }
        if (variant.available) {
            $(".product-quick-view .add-to-cart").removeClass("disabled").removeAttr("disabled").children('span').html(window.inventory_text.add_to_cart),
            variant.inventory_management && variant.inventory_quantity <= 0 ? ($("#selected-variant").html(selector.product.title + " - " + variant.title), $("#backorder").removeClass("hidden")) : $("#backorder").addClass("hidden");
          if (variant.inventory_management!=null) {
            $(".product-inventory span.in-stock").text(window.inventory_text.in_stock);
          } else {
            $(".product-inventory span.in-stock").text(window.inventory_text.many_in_stock);
          }
          $('.product-sku span.sku').text(variant.sku);
        }else{
          $("#backorder").addClass("hidden"), $(".product-quick-view .add-to-cart").addClass("disabled").attr("disabled", "disabled").children('span').html(window.inventory_text.sold_out);
          $(".product-inventory span.in-stock").text(window.inventory_text.out_of_stock);
          $('.product-sku span.sku').empty();
        }
        if(swatch_color_type == '1' || swatch_color_type == '2') {
          var form = $('#' + selector.domIdPrefix).closest('form');
          for (var i=0,length=variant.options.length; i<length; i++) {
            var radioButton = form.find('.swatch[data-option-index="' + i + '"] :radio[value="' + variant.options[i] +'"]');
            if (radioButton.size()) {
              radioButton.get(0).checked = true;
            }
          }
        }
      }
      if (variant && variant.featured_image) {
        var n = Shopify.Image.removeProtocol(variant.featured_image.src);
        $(".product-image-thumbs .thumb-link").filter('[data-zoom-image="' + n + '"]').trigger("mouseenter");
      }
      variant && variant.sku ? $("#sku").removeClass("hidden").find("span").html(variant.sku) : $("#sku").addClass("hidden").find("span").html("");
    };
    convertToSlug= function(e) {
      return e.toLowerCase().replace(/[^a-z0-9 -]/g, "").replace(/\s+/g, "-").replace(/-+/g, "-")
    };
    $(function() {
      {% if product.available and product.variants.size >= 1 %}
      var product = {{product | json}};
      var layout = $('.product-quick-view');
      if (product.variants.length >= 1) { //multiple variants
        for (var i = 0; i < product.variants.length; i++) {
          var variant = product.variants[i];
          var option = '<option value="' + variant.id + '">' + variant.title + '</option>';
          layout.find('form.product-form > select').append(option);
        }
        new Shopify.OptionSelectors("quick-product-selectors", {
          product: product,
          onVariantSelected: selectCallback,
          enableHistoryState: true
        });

        //start of quickview variant;
        var filePath = asset_url.substring(0, asset_url.lastIndexOf('/'));
        var assetUrl = asset_url.substring(0, asset_url.lastIndexOf('/'));
        var options = "";
        for (var i = 0; i < product.options.length; i++) {
          options += '<div class="swatch clearfix" data-option-index="' + i + '">';
          options += '<div class="header">' + product.options[i] + ':</div>';
          options += '<div class="variant-items">';
          var is_color = false;
          var is_square = 'square';
          if (/Color|Colour/i.test(product.options[i])) {
            is_color = true;
          }
          if (swatch_color_type == '2') {
            is_color = false;
            is_square = '';
          }
          var optionValues = new Array();
          for (var j = 0; j < product.variants.length; j++) {
            var variant = product.variants[j];
            var value = variant.options[i];
            if(variant.featured_image && product_swatch_setting == '2') {
              var img = variant.featured_image.src.lastIndexOf(".");
              var vimg = variant.featured_image.src.slice(0, img) + "_50x50_crop_center" + variant.featured_image.src.slice(img);
            }
            var valueHandle = convertToSlug(value);
            var forText = 'swatch-{{product.id}}-' + i + '-' + valueHandle;
            if (optionValues.indexOf(value) < 0) {
              //not yet inserted
              options += '<div data-value="' + value + '" class="swatch-element '+is_square+' '+product_swatch_size+' '+(is_color ? "color" : "")+' ' + (is_color ? "color" : "") + valueHandle + (variant.available ? ' available ' : ' soldout ') + '">';

              if (is_color) {
                options += '<div class="tooltip">' + value + '</div>';
              }
              options += '<input id="' + forText + '" type="radio" name="option-' + i + '" value="' + value + '" ' + (j == 0 ? ' checked ' : '') + (variant.available ? '' : ' disabled') + ' />';

              if (is_color) {
                if(vimg && product_swatch_setting == '2') {
                  options += '<label for="' + forText + '" class="swatch-image" style="overflow:hidden;"><img src="' + vimg + '" class="variant-image" style="max-width:100%;" /><img class="crossed-out" src="' + assetUrl + 'soldout.png" /></label>';
                }else{
                  options += '<label for="' + forText + '" style="background-color: ' + valueHandle + '; background-image: url(' + filePath + valueHandle + '.png)"><img class="crossed-out" src="' + assetUrl + 'soldout.png" /></label>';
                }
              } else {
                options += '<label for="' + forText + '">' + value + '<img class="crossed-out" src="' + assetUrl + 'soldout.png" /></label>';
              }
              options += '</div>';
              if (variant.available) {
                $('.product-quick-view .swatch[data-option-index="' + i + '"] .' + valueHandle).removeClass('soldout').addClass('available').find(':radio').removeAttr('disabled');
              }
              optionValues.push(value);
            }
          }
          options += '</div>';
          options += '</div>';
        }
        if(swatch_color_type == '1' || swatch_color_type == '2') {
          layout.find('form.product-form .product-options > select').after(options);
          layout.find('.swatch :radio').change(function() {
            var optionIndex = $(this).closest('.swatch').attr('data-option-index');
            var optionValue = $(this).val();
            $(this)
            .closest('form')
            .find('.single-option-selector')
            .eq(optionIndex)
            .val(optionValue)
            .trigger('change');
          });
        }
        if (product.available) {
          Shopify.quickOptionsMap = {};
          Shopify.quickLinkOptionSelectors(product);
        }
        //end of quickview variant
      } else { //single variant
        layout.find('form.product-form .product-options > select').remove();
        var variant_field = '<input type="hidden" name="id" value="' + product.variants[0].id + '">';
        layout.find('form.product-form').append(variant_field);
      }
      {% endif %}
    });
  </script> 
  <script>
    var customVariantObject = {};    
    {% for var in product.variants %}
    customVariantObject[{{- var.id -}}] = {inventoryQuantity: {{ var.inventory_quantity | default: 0 }}};
    {% endfor %}
    const oldQueryString = window.location.search;
    const oldurlParams = new URLSearchParams(oldQueryString);
    let oldVariantID = oldurlParams.get ("variant");
    const variantSelectorElement = document.querySelector(".product-options");
    variantSelectorElement.addEventListener('change', function() {
    const newQueryString = window.location.search;
    const newurlParams = new URLSearchParams (newQueryString);
    let newVariantID = newurlParams.get ("variant"); 
    if(newVariantID != oldVariantID) {
    oldVariantID = newVariantID;
    let LiveInventoryCount = document.querySelectorAll(".live-inventory-count");
    for (let i = 0; i < LiveInventoryCount.length; i++ ) {
    if (customVariantObject[newVariantID].inventoryQuantity <=0 ) {LiveInventoryCount[i].innerHTML =`Out of Stock`}
    else if (customVariantObject[newVariantID].inventoryQuantity > 0 &&  customVariantObject[newVariantID].inventoryQuantity <=10 ) {LiveInventoryCount[i].innerHTML =`Hurry Up! Only ${customVariantObject[newVariantID].inventoryQuantity} left`;}
    else {LiveInventoryCount[i].innerHTML =`We have ${customVariantObject[newVariantID].inventoryQuantity} Available in Stock!`;}
    }}  
    });
  </script>
</div>